# Puzzle Start Dialog — Technical Documentation 

## Краткое описание
Это демонстрационный модуль диалога старта пазла:
- Галерея превью → диалог старта → fake-loading → старт.
- Поддерживается три режима старта: Free, Coins, Ads.
- Политика старта вынесена в ScriptableObject (`PuzzleStartPolicy`).
- Стратегии старта реализованы через **DI**: каждая стратегия получает свои зависимости в конструкторе.
- Presenter остаётся лёгким: выбирает стратегию и делегирует запуск ей.

## Почему стратегия через DI?
Я сознательно сделал так:
- **Явные зависимости** упрощают тестирование: стратегия получает мок-зависимости в конструкторе.
- **SRP**: Presenter не знает детали выполнения старта (платёж/реклама/загрузка).
- **OCP**: добавить новый режим — реализовать новую стратегию и зарегистрировать её в DI.
- **Прозрачность**: легко увидеть, что нужно стратегии (Ads, Loading, Wallet, View, Policy).

## Ключевые сущности
- **IPuzzleStartStrategy** — контракт; `TryStartAsync(context, ct)` возвращает `bool` (успех).
- **FreeStartStrategy / CoinsStartStrategy / AdsStartStrategy** — реализации, принимают зависимости через конструктор.
- **PuzzleStartPolicy (ScriptableObject)** — пороги и стоимость; Presenter использует policy для выбора режима.
- **PuzzleDialogPresenter** — подписывается на UI события, выбирает стратегию и вызывает `TryStartAsync`.
- **PuzzleStartContext** — минимальный (meta + pieces) — передаётся в `TryStartAsync` как payload.
- **IWallet** — reactive wallet (UniRx), предоставляет `CanSpend`/`Spend`/`Put`.

## Точки расширения
- Добавить `SubscriptionStartStrategy` (новая стратегия) — не трогаем Presenter.
- Подменить `MockPreviewService` / `MockLoadingService` на реальные реализации (http, Addressables).
- Вынести стратегию регистрации в конфигурацию (Feature flags / Remote config).
- Добавить аналитические хуки в стратегии / presenter (через DI).


## Почему я сделал так 
- Для меня важно показать: **архитектурные решения + тестируемость + расширяемость**.
- DI-inside-strategy даёт явные контрактные границы, что упрощает код ревью и замену реализации (реальная реклама/реальная платёжная система).
- Presenter остаётся оркестратором — он выбирает стратегию и не делает платёжную/рекламную/загрузочную логику.

## Что можно улучшить (next steps)
- Добавить больше интеграционных/PlayMode тестов (UI + flow).
- Внедрить Addressables/file cache на реальные превью.
- Подключить реальные Ads SDK через adapter, и добавить fallback strategy.
